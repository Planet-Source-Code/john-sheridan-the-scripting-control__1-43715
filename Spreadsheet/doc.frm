VERSION 5.00
Begin VB.Form doc 
   Caption         =   "New JS Sheet"
   ClientHeight    =   7695
   ClientLeft      =   60
   ClientTop       =   450
   ClientWidth     =   11880
   Icon            =   "doc.frx":0000
   LinkTopic       =   "Form2"
   MDIChild        =   -1  'True
   ScaleHeight     =   7695
   ScaleWidth      =   11880
   WindowState     =   2  'Maximized
   Begin VB.OptionButton row 
      Caption         =   "2"
      Height          =   255
      Index           =   30
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   30
      Top             =   7440
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "2"
      Height          =   255
      Index           =   29
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   29
      Top             =   7200
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "1"
      Height          =   255
      Index           =   28
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   28
      Top             =   6960
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "4"
      Height          =   255
      Index           =   27
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   27
      Top             =   6720
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "3"
      Height          =   255
      Index           =   26
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   26
      Top             =   6480
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "2"
      Height          =   255
      Index           =   25
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   25
      Top             =   6240
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "1"
      Height          =   255
      Index           =   24
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   24
      Top             =   6000
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "4"
      Height          =   255
      Index           =   23
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   23
      Top             =   5760
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "3"
      Height          =   255
      Index           =   22
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   22
      Top             =   5520
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "2"
      Height          =   255
      Index           =   21
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   21
      Top             =   5280
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "1"
      Height          =   255
      Index           =   20
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   20
      Top             =   5040
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "4"
      Height          =   255
      Index           =   19
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   19
      Top             =   4800
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "3"
      Height          =   255
      Index           =   18
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   18
      Top             =   4560
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "2"
      Height          =   255
      Index           =   17
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   17
      Top             =   4320
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "1"
      Height          =   255
      Index           =   16
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   16
      Top             =   4080
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "4"
      Height          =   255
      Index           =   15
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   15
      Top             =   3840
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "3"
      Height          =   255
      Index           =   14
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   14
      Top             =   3600
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "2"
      Height          =   255
      Index           =   13
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   13
      Top             =   3360
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "1"
      Height          =   255
      Index           =   12
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   12
      Top             =   3120
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "4"
      Height          =   255
      Index           =   11
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   11
      Top             =   2880
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "3"
      Height          =   255
      Index           =   10
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   10
      Top             =   2640
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "2"
      Height          =   255
      Index           =   9
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   9
      Top             =   2400
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "1"
      Height          =   255
      Index           =   8
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   8
      Top             =   2160
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "4"
      Height          =   255
      Index           =   7
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   7
      Top             =   1920
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "3"
      Height          =   255
      Index           =   6
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   6
      Top             =   1680
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "2"
      Height          =   255
      Index           =   5
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   5
      Top             =   1440
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "1"
      Height          =   255
      Index           =   4
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   4
      Top             =   1200
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "4"
      Height          =   255
      Index           =   3
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   3
      Top             =   960
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "3"
      Height          =   255
      Index           =   2
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   2
      Top             =   720
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "2"
      Height          =   255
      Index           =   1
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   1
      Top             =   480
      Width           =   855
   End
   Begin VB.OptionButton row 
      Caption         =   "1"
      Height          =   255
      Index           =   0
      Left            =   0
      Style           =   1  'Graphical
      TabIndex        =   0
      Top             =   240
      Width           =   855
   End
   Begin VB.TextBox formula 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFF00&
      BeginProperty Font 
         Name            =   "Lucida Console"
         Size            =   6
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   285
      Left            =   0
      TabIndex        =   42
      Top             =   0
      Width           =   855
   End
   Begin VB.TextBox cellA 
      Appearance      =   0  'Flat
      Height          =   285
      Index           =   0
      Left            =   840
      TabIndex        =   41
      Top             =   240
      Width           =   1095
   End
   Begin VB.Label col 
      Alignment       =   2  'Center
      BorderStyle     =   1  'Fixed Single
      Caption         =   "A"
      Height          =   255
      Index           =   0
      Left            =   840
      TabIndex        =   31
      Top             =   0
      Width           =   1095
   End
   Begin VB.Label col 
      Alignment       =   2  'Center
      BorderStyle     =   1  'Fixed Single
      Caption         =   "J"
      Height          =   255
      Index           =   9
      Left            =   10560
      TabIndex        =   40
      Top             =   0
      Width           =   1095
   End
   Begin VB.Label col 
      Alignment       =   2  'Center
      BorderStyle     =   1  'Fixed Single
      Caption         =   "I"
      Height          =   255
      Index           =   8
      Left            =   9480
      TabIndex        =   39
      Top             =   0
      Width           =   1095
   End
   Begin VB.Label col 
      Alignment       =   2  'Center
      BorderStyle     =   1  'Fixed Single
      Caption         =   "H"
      Height          =   255
      Index           =   7
      Left            =   8400
      TabIndex        =   38
      Top             =   0
      Width           =   1095
   End
   Begin VB.Label col 
      Alignment       =   2  'Center
      BorderStyle     =   1  'Fixed Single
      Caption         =   "G"
      Height          =   255
      Index           =   6
      Left            =   7320
      TabIndex        =   37
      Top             =   0
      Width           =   1095
   End
   Begin VB.Label col 
      Alignment       =   2  'Center
      BorderStyle     =   1  'Fixed Single
      Caption         =   "F"
      Height          =   255
      Index           =   5
      Left            =   6240
      TabIndex        =   36
      Top             =   0
      Width           =   1095
   End
   Begin VB.Label col 
      Alignment       =   2  'Center
      BorderStyle     =   1  'Fixed Single
      Caption         =   "E"
      Height          =   255
      Index           =   4
      Left            =   5160
      TabIndex        =   35
      Top             =   0
      Width           =   1095
   End
   Begin VB.Label col 
      Alignment       =   2  'Center
      BorderStyle     =   1  'Fixed Single
      Caption         =   "D"
      Height          =   255
      Index           =   3
      Left            =   4080
      TabIndex        =   34
      Top             =   0
      Width           =   1095
   End
   Begin VB.Label col 
      Alignment       =   2  'Center
      BorderStyle     =   1  'Fixed Single
      Caption         =   "C"
      Height          =   255
      Index           =   2
      Left            =   3000
      TabIndex        =   33
      Top             =   0
      Width           =   1095
   End
   Begin VB.Label col 
      Alignment       =   2  'Center
      BorderStyle     =   1  'Fixed Single
      Caption         =   "B"
      Height          =   255
      Index           =   1
      Left            =   1920
      TabIndex        =   32
      Top             =   0
      Width           =   1095
   End
End
Attribute VB_Name = "doc"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Public selCol, selRow As Integer
Public selectedCell As Integer
Public fileName As String
Public addC As Boolean

Function rowfromindex(Index As Integer) As Integer

For i = 0 To row.Count - 1

If cellA(Index).Top = row(i).Top Then rowfromindex = i + 1

Next i

End Function

Function colFromIndex(Index As Integer) As String

Dim temp As Integer

For i = 0 To col.Count - 1

If cellA(Index).Left = col(i).Left Then temp = i

Next i


colFromIndex = Chr(65 + temp)

End Function

Function isInt(intInt As String) As Boolean
On Error GoTo escape

intInt = Sqr(intInt)
isInt = True

Exit Function
escape:
isInt = False
End Function

Function saveSheet(src As String)
On Error GoTo esc
Open src For Output As #1

For i = 0 To cellA.Count - 1

If cellA(i).Text = "" And cellA(i).Tag = "" Then GoTo arr
'if the cell is empty

Dim theTag
If cellA(i).Tag <> "" Then theTag = cellA(i).Tag Else theTag = "X"
'get the formula, or lack thereof

Dim delim As String
delim = "|"


Print #1, i & delim & cellA(i).Text & delim & theTag
'print the string to the file

arr:
Next i


Close #1

fileName = src

esc:
'this is just to prevent from changing fileName
End Function


Function openSheet(src As String)
On Error GoTo errHand

clear

Open src For Input As #1

Do Until EOF(1)


Line Input #1, ValU

Dim delim As String, values() As String
delim = "|"
values() = Split(ValU, delim)

cellA(values(0)).Text = values(1)
If values(2) = "X" Then GoTo esc
cellA(values(0)).Tag = values(2)
esc:
Loop

Close #1

fileName = src

Exit Function
errHand:
MsgBox "File was either corrupt or not found.", vbInformation, "Sheet+"
End Function

Function clear()
For i = 0 To cellA.Count - 1
cellA(i).Text = ""
cellA(i).Tag = ""
Next i

fileName = ""
End Function

Sub loadStuff()

'load textboxes
For X = 0 To col.Count - 1

  For i = cellA.Count To (row.Count - 1) + (31 * X)
  Load cellA(i)
  cellA(i).Visible = True
  cellA(i).Left = col(X).Left
  cellA(i).Top = row(i - (31 * X)).Top
  Next i

Next X



For i = 0 To row.Count - 1

row(i).Caption = i + 1

Next i
'write captions

End Sub

Public Sub doScript()
On Error Resume Next

Dim mathCTL
Set mathCTL = CreateObject("ScriptControl")
mathCTL.language = "VBScript"

Dim i As Integer

For i = 0 To cellA.Count - 1

If cellA(i).Text = "" Then GoTo esc
If isInt(cellA(i).Text) Then GoTo handleInteger

mathCTL.executestatement colFromIndex(i) & rowfromindex(i) & " = """ & cellA(i).Text & """"

GoTo escEsc

esc:


mathCTL.executestatement colFromIndex(i) & rowfromindex(i) & " = """""
escEsc:
Next i
'the above code sets the cells to variables in the scripting control

Dim n As Integer
For n = 0 To cellA.Count - 1

If Left(cellA(n).Tag, 1) = "=" Then
'if its a formula

Dim formula As String 'our formula
formula = Right(cellA(n).Tag, Len(cellA(n).Tag) - 1)

Dim program As String 'program to get formula
program = "Function ret()" & vbCrLf & _
          "ret = " & formula & vbCrLf & _
          "End Function"

mathCTL.addcode program  'add our program to the Scripting control
cellA(n).Text = mathCTL.run("ret")  'return the value to the textbox

End If

Next n


Exit Sub
handleInteger:
mathCTL.executestatement colFromIndex(i) & rowfromindex(i) & " = " & cellA(i).Text
GoTo escEsc
End Sub


Private Sub cellA_Change(Index As Integer)
If Left(cellA(Index).Text, 1) = "=" Then
cellA(Index).Tag = cellA(Index).Text
End If
End Sub

Private Sub cellA_Click(Index As Integer)
On Error Resume Next
cellA(Index).SetFocus
If addC = True Then
addCells.addNum cellA(Index).Text
End If
selectedCell = Index
formula.Text = cellA(Index).Tag
End Sub

Private Sub cellA_GotFocus(Index As Integer)
For i = 0 To cellA.Count - 1
cellA(i).BackColor = vbWhite
Next i

cellA(Index).BackColor = vbGreen
'select the cell


For i = 0 To col.Count - 1
 If cellA(Index).Left = col(i).Left Then
 selCol = i
    For colz = 0 To col.Count - 1
       col(colz).BackColor = &H8000000F
    Next colz
 col(i).BackColor = RGB(255, 0, 0)
 End If

Next i
'select the column


For i = 0 To row.Count - 1
If cellA(Index).Top = row(i).Top Then row(i).Value = True: selRow = i
Next i
'select the row
doScript
End Sub



Private Sub cellA_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)
If KeyCode = vbKeyReturn Then doScript
End Sub



Private Sub col_Click(Index As Integer)
selCol = Index

For i = 0 To col.Count - 1
col(i).BackColor = &H8000000F
Next i

col(Index).BackColor = RGB(255, 0, 0)
'select column


cellA(selRow + (Index * 31)).SetFocus
'select cell
End Sub

Private Sub col_MouseUp(Index As Integer, Button As Integer, Shift As Integer, X As Single, Y As Single)
col_Click (Index)
If Button = 2 Then

PopupMenu Form1.mnu

End If
End Sub


Private Sub Form_Load()
loadStuff
Form1.fileOpen = True
End Sub

Private Sub Form_Unload(Cancel As Integer)
Save% = MsgBox("Save work?", vbYesNoCancel, "Sheet+")
Select Case Save%
  Case vbYes:
  'save work and close
  Form1.fileOpen = False
  
    If fileName = "" Then
     savea.Show vbModal
    Else
     saveSheet fileName
    End If
  
  fileName = ""
  
  Case vbNo:
  Unload Me
  Form1.fileOpen = False
  fileName = ""
  Case Else:
  Cancel = 1
  
End Select
End Sub

Private Sub formula_Change()
cellA(selectedCell).Tag = formula.Text

End Sub

Private Sub row_Click(Index As Integer)
cellA(Index + (selCol * 31)).SetFocus
'select cell
selRow = Index
'select row
End Sub
